<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Poem Viewer</title>

<style>
  :root {
    --navy: #0b1f3a;
    --navy-light: #1c355e;
    --white: #ffffff;
  }

  body {
    font-family: Georgia, serif;
    margin: 40px;
    background: var(--white);
    color: var(--navy);
  }

  .poem-container {
    border: 3px solid var(--navy);
    padding: 26px;
    border-radius: 12px;
    max-width: 820px;
    margin: auto;
    box-shadow: 0 10px 28px rgba(11, 31, 58, 0.18);
  }

  .poem-title {
    font-size: 2.3rem;
    text-align: center;
    font-weight: bold;
  }

  .poem-author {
    text-align: center;
    font-style: italic;
    margin-bottom: 1.4rem;
    color: var(--navy-light);
  }

  .poem-body {
    white-space: pre-wrap;
    font-size: 1.15rem;
    line-height: 1.75;
  }

  .controls {
    max-width: 820px;
    margin: 28px auto;
    padding: 18px;
    border: 2px solid var(--navy);
    border-radius: 10px;
    display: grid;
    gap: 16px;
  }

  .themes {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 10px;
  }

  .theme-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: bold;
  }

  input[type="checkbox"] {
    width: 18px;
    height: 18px;
    accent-color: var(--navy);
    cursor: pointer;
  }

  label {
    cursor: pointer;
  }

  .row {
    display: flex;
    flex-wrap: wrap;
    gap: 14px;
    align-items: center;
    justify-content: space-between;
  }

  input[type="number"] {
    width: 90px;
    padding: 6px 8px;
    font-size: 1rem;
    border: 2px solid var(--navy);
    border-radius: 6px;
    color: var(--navy);
  }

  button {
    padding: 10px 22px;
    font-size: 1rem;
    font-weight: bold;
    color: var(--white);
    background: var(--navy);
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }

  button:hover {
    background: var(--navy-light);
  }
</style>
</head>

<body>

<div class="poem-container">
  <div id="poem-title" class="poem-title">Loading…</div>
  <div id="poem-author" class="poem-author"></div>
  <div id="poem-body" class="poem-body"></div>
</div>

<div class="controls">

  <strong>Select themes:</strong>

  <div class="themes">
    <label class="theme-item"><input type="checkbox" value="love"> Love</label>
    <label class="theme-item"><input type="checkbox" value="nature"> Nature</label>
    <label class="theme-item"><input type="checkbox" value="death"> Death</label>
    <label class="theme-item"><input type="checkbox" value="night"> Night</label>
    <label class="theme-item"><input type="checkbox" value="time"> Time</label>
    <label class="theme-item"><input type="checkbox" value="dream"> Dreams</label>
    <label class="theme-item"><input type="checkbox" value="war"> War</label>
    <label class="theme-item"><input type="checkbox" value="god"> Faith</label>
  </div>

  <div class="row">
    <label>
      Max lines:
      <input id="maxLinesInput" type="number" min="1" value="40">
    </label>

    <button onclick="loadPoem()">Load Next Poem</button>
  </div>

</div>

<script>
function getSelectedThemes() {
  return Array.from(document.querySelectorAll('input[type="checkbox"]:checked'))
    .map(cb => cb.value);
}

async function loadPoem() {
  const titleEl = document.getElementById('poem-title');
  const authorEl = document.getElementById('poem-author');
  const bodyEl = document.getElementById('poem-body');
  const maxLines = parseInt(document.getElementById('maxLinesInput').value, 10);
  const themes = getSelectedThemes();

  titleEl.textContent = 'Loading…';
  authorEl.textContent = '';
  bodyEl.textContent = '';

  try {
    let poem;

    while (!poem || poem.lines.length > maxLines) {
      let url = 'https://poetrydb.org/random';

      if (themes.length > 0) {
        const chosenTheme = themes[Math.floor(Math.random() * themes.length)];
        url = `https://poetrydb.org/lines/${chosenTheme}/random`;
      }

      const response = await fetch(url);
      const data = await response.json();
      poem = data[0];
    }

    titleEl.textContent = poem.title;
    authorEl.textContent = `by ${poem.author}`;
    bodyEl.textContent = poem.lines.join('\n');

  } catch (err) {
    titleEl.textContent = 'Error loading poem.';
    console.error(err);
  }
}

loadPoem();
</script>

</body>
</html>
